# –ü—Ä–æ–µ–∫—Ç Koshki

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### üîπ 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—â—ë –Ω–µ—Ç Docker:

- [–°–∫–∞—á–∞—Ç—å Docker Desktop](https://www.docker.com/products/docker-desktop/)

---

### üîπ 2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ Elasticsearch

–ó–∞–ø—É—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ **Elasticsearch** –≤–µ—Ä—Å–∏–∏ 8.x (–ø—Ä–æ–µ–∫—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ 8.13.0):

```bash
docker run --name elastic-local -p 9200:9200 -e "discovery.type=single-node" elasticsearch:8.13.0
````

‚úÖ –£–±–µ–¥–∏—Å—å, —á—Ç–æ Elasticsearch –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:9200
```

---

### üîπ 3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ Kibana

–ó–∞–ø—É—Å—Ç–∏ **Kibana** —á–µ—Ä–µ–∑ Docker:

```bash
docker run --name kibana-local -p 5601:5601 --link elastic-local:elasticsearch kibana:8.13.0
```

‚úÖ Kibana –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:5601
```

---

### üîπ 4Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–£–±–µ–¥–∏—Å—å, —á—Ç–æ —É —Ç–µ–±—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python 3.10+

–£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install fastapi uvicorn elasticsearch==8.7.0 python-json-logger aio-pika==9.4.0
```

‚ùó –í–∞–∂–Ω–æ: –ò—Å–ø–æ–ª—å–∑—É–π –∫–ª–∏–µ–Ω—Ç **elasticsearch** –≤–µ—Ä—Å–∏–∏ 8.x –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º 8.x

---

## ‚öôÔ∏è Middleware –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è FastAPI

* –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å —Å –ø–æ–ª—è–º–∏:

  ```
  @timestamp, level, logger, class, event, message, summary, ErrClass, ErrMethod, params
  ```
---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ElasticsearchHandler

* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏ –≤ –∏–Ω–¥–µ–∫—Å **koshki-logs**
* –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Kibana

1Ô∏è‚É£ –ü–µ—Ä–µ–π–¥–∏ –≤ Kibana ‚Üí **Stack Management** ‚Üí **Index Patterns (–∏–ª–∏ Data Views)**
2Ô∏è‚É£ –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å-–ø–∞—Ç—Ç–µ—Ä–Ω:

```
koshki-logs*
```

3Ô∏è‚É£ –í—ã–±–µ—Ä–∏ –ø–æ–ª–µ **@timestamp** –∫–∞–∫ –ø–æ–ª–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
4Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω–∏ –∏–Ω–¥–µ–∫—Å-–ø–∞—Ç—Ç–µ—Ä–Ω

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ó–∞–ø—É—Å—Ç–∏ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
uvicorn src.interface.main:app --reload
```

–°–¥–µ–ª–∞–π –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—É—á–∏ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ—à–µ–∫).

‚úÖ –ü–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞:

* –ü—Ä–æ–≤–µ—Ä—å –≤ Kibana ‚Üí **Discover**
* –í—ã–±–µ—Ä–∏ –∏–Ω–¥–µ–∫—Å-–ø–∞—Ç—Ç–µ—Ä–Ω `koshki-logs*`
* –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ª–æ–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π –∏ –ø–æ–ª—è–º–∏

